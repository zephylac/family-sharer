{% extends "layout.html" %}
{% block body %}
{% if session.logged_in %}
<script type="text/javascript">
  function fillForm(title,text){
  var head = document.getElementById('inputTitle');
  head.defaultValue = title;
  var elem = document.getElementById('textArea');
  elem.defaultValue = text;
  }
</script>



<div class="container">
  <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#myModal"> Add news </button>
  <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#myModal2"> Add routes </button>
  <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#myModal3"> Add boulder </button>
<div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Add news</h4>
      </div>
      <div class="modal-body">
	<form action={{ url_for('website_panel') }} class="form-horizontal" method=post id="news">
          <fieldset>
            <div class="form-group">
              <label for="inputTitle" class="col-lg-2 control-label">Title</label>
              <div class="col-lg-10">
                <input type="text" name="title" class="form-control" id="inputTitle" placeholder="Title">
              </div>
            </div>
           <div class="form-group">
             <label for="textArea" class="col-lg-2 control-label">News</label>
             <div class="col-lg-10">
               <textarea class="form-control" name="text" rows="10" id="textArea" placeholder="Insert text..."></textarea>
             </div>
           </div>
           <div class="form-group">
             <div class="col-lg-10 col-lg-offset-2">
               <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               <button type="submit" class="btn btn-primary">Submit</button>
             </div>
           </div>
         </fieldset>
       </form>
     </div>
   </div>
 </div>
</div>

<div class="modal" id="myModal2">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">New route</h4>
      </div>
      <div class="modal-body">
	<form action={{ url_for('website_panel') }} class="form-horizontal" method=post id="route">
          <fieldset>
            <div class="form-group">
              <label for="grade" class="col-lg-2 control-label">Grade</label>
              <div class="col-lg-10">
                <input type="text" name="grade" class="form-control" id="grade" placeholder="Grade">
              </div>
            </div>
           <div class="form-group">
             <label for="color" class="col-lg-2 control-label">Color</label>
             <div class="col-lg-10">
               <input type="text" name="color" class="form-control" id="color" placeholder="Color">
             </div>
           </div>
           <div class="form-group">
             <label for="comment" class="col-lg-2 control-label">Comment</label>
             <div class="col-lg-10">
               <textarea class="form-control" name="comment" rows="10" id="comment" placeholder="Comment..."></textarea>
             </div>
           </div>
	   <div class="form-group">
              <label for="tested" class="col-lg-2 control-label">Tested</label>
              <div class="col-lg-10">
                <select class="form-control" name="tested" id="tested">
                  <option value=1>True</option>
                  <option value=0>False</option>
                </select>
	      </div>
           </div>
           <div class="form-group">
             <label for="gym" class="col-lg-2 control-label">Gym</label>
             <div class="col-lg-10">
               <select class="form-control" name="gym" id="gym">
	         {% for entry in gym %}
	         <option value="{{entry.gym_alias}}">{{entry.name}}</option>
	         {% endfor %}
               </select>
	     </div>
           </div>
           <div class="form-group">
             <div class="col-lg-10 col-lg-offset-2">
               <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               <button type="submit" class="btn btn-primary">Submit</button>
             </div>
           </div>
         </fieldset>
       </form>
     </div>
   </div>
 </div>
</div>



<div class="modal" id="myModal3">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Choose image</h4>
      </div>
      <div class="modal-body">
            <form id="form3" class="form-horizontal" action="{{url_for('website_panel')}}" method="post" enctype="multipart/form-data"> 
              <fieldset>
                <div class="form-group">
                  <label for="my-dropzone" class="col-lg-2 control-label">Image</label>
                  <div class="col-lg-10">
                    <div class="dropzone" id="my-dropzone" name="mainFileUploader">
                    </div>                   
                  </div>
                </div>
                <div class="form-group">
                  <label for="gym2" class="col-lg-2 control-label">Gym</label>
                  <div class="col-lg-10">
                    <select class="form-control" name="gym2" id="gym2">
		    {% for entry in gym %}
		    <option value="{{entry.gym_alias}}">{{entry.name}}</option>
		    {% endfor %}
                    </select>
	          </div>
                </div>
	        <div class="form-group">
                <label for="title2" class="col-lg-2 control-label">Title</label>
                  <div class="col-lg-10">
                    <input type="text" name="title2" class="form-control" id="title2" placeholder="Title">
                  </div>
                </div>
                <div class="form-group">
                  <label for="text2" class="col-lg-2 control-label">Comment</label>
                  <div class="col-lg-10">
                    <textarea class="form-control" name="text2" rows="10" id="text2" placeholder="Insert text..."></textarea>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-lg-10 col-lg-offset-2">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-default" id="submit-all"> Submit </button>
                  </div>
                </div>
              </fieldset>
            </form>
<script>
        Dropzone.options.myDropzone = {
            url: "/website_panel",
            autoProcessQueue: false,
            uploadMultiple: false,
            parallelUploads: 100,
            maxFiles: 100,
            acceptedFiles: "image/*",
            init: function () {
                var submitButton = document.querySelector("#submit-all");
                var wrapperThis = this;

                submitButton.addEventListener("click", function (e) {
                    wrapperThis.processQueue();
                });

                this.on("addedfile", function (file) {

                    // Create the remove button
                    var removeButton = Dropzone.createElement("<button class='btn btn-lg dark'>Remove File</button>");

                    // Listen to the click event
                    removeButton.addEventListener("click", function (e) {
                        // Make sure the button click doesn't submit the form:
                        e.preventDefault();
                        e.stopPropagation();

                        // Remove the file preview.
                        wrapperThis.removeFile(file);
                        // If you want to the delete the file on the server as well,
                        // you can do the AJAX request here.
                    });

                    // Add the button to the file preview element.
                    file.previewElement.appendChild(removeButton);
                });
		this.on('sending', function(data, xhr, formData){
                    formData.append("gym2", $("#gym2").val());
                    formData.append("title2", $("#title2").val());
                    formData.append("text2", $("#text2").val());
        });
            }
        };
    </script>
      </div>
    </div>
  </div>
</div>





{% for entry in news %}
<div class="panel panel-primary" id="paneprime{{loop.index}}">
  <div class="panel-heading">
    <div class="btn-toolbar">
      <button type="button" class="btn btn-default btn-group pull-right" aria-label="remove" data-dismiss="alert" data-target="#paneprime{{loop.index}}">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
    <a class="btn-group pull-right" href={{ url_for('website_panel',id = entry.id) }}>
      <button type="button" class="btn btn-default" aria-label="trash">
        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
      </button>
    </a>
    <button type="button" class="btn btn-default btn-group pull-right" aria-label="edit" data-toggle="modal" data-target="#myModal" onclick="fillForm('{{ entry.title }}','{{ entry.text }}')">
      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
    </button>
    <h1 class="panel-title">Title : {{ entry.title }}</h1>
    <h3 class="panel-title">Date : {{ entry.date }}</h3>
    </div>
  </div>
  <div class="panel-body">{{entry.text}}</div>
</div>
{% endfor %}

{% for entry in img %}
<div class="panel panel-primary" id="paneimg{{loop.index}}">
  <div class="panel-heading">
    <div class="btn-toolbar">
      <button type="button" class="btn btn-default btn-group pull-right" aria-label="remove" data-dismiss="alert" data-target="#paneimg{{loop.index}}">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
    <a class="btn-group pull-right" href={{ url_for('website_panel',img = entry.id) }}>
      <button type="button" class="btn btn-default" aria-label="trash">
        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
      </button>
    </a>
    <h1 class="panel-title">Image : {{ entry.name }}</h1>
    </div>
  </div>
  <div class="panel-body">
    <div class="col-lg-10 col-lg-offset-1">
      <img src="/static/img/climb/{{entry.name}}" class="img-responsive center-block" alt="{{ entry.name }}">
    </div>
  </div>
</div>
{% endfor %}


</div>

{% else %}
  <h2> You need to log in </h2>
{% endif %}

{% endblock %}

